---
layout: post
title: "Monit - system monitorization tool"
description: ""
category: [monit]
tags: [server, system, monitorization]
---
{% include JB/setup %}

Sources: 

- <http://linux.die.net/man/1/monit>
- <https://fak3r.com/2010/04/10/howto-use-monit-to-monitor-sites-and-alert-users/>
- <http://www.binarytides.com/install-monit-debian/>
- <http://www.tecmint.com/how-to-install-and-setup-monit-linux-process-and-services-monitoring-program/>
- <https://www.digitalocean.com/community/tutorials/lemp-stack-monitoring-with-monit-on-ubuntu-14-04>

Installation

    # yum install monit

Start service

    # systemctl start monit.service

Status

    # monit status
    # service monit status   == systemctl status monit.service

Reload after config changes

    # monit reload

Permissions

    # groupadd monit
    # usermod -a G monit <username>

In monitrc, allow access to users of group monit
    set httpd port 2812
      allow @monit

Configuration

    # vi /etc/monitrc

    # using gmail as mail server
    Must allow less secure apps in gmail my_account/sign-in & security/connected apps & sites/
    set mailserver smtp.gmail.com port 587 username "xxxx@gmail.com" password "password" using tlsv1 with timeout 30 seconds

    set alert sysop@example.com                       # receive all alerts
    set alert sysadm@example.com not on { instance }  # receive only real alerts

Logging

    /var/log/monit.log

Nginx config to serve monit embedded web server: 67webs.com/monit

    server {
        client_max_body_size 20M;
        client_body_temp_path /var/www/uploads_temp;
        listen  80;
        # server_name  sharingkitchn.com *.sharingkitchn.com;
        server_name  67webs.com *.67webs.com;
        root         /var/www/shk;

        location / {
                proxy_pass_header Server;
                proxy_temp_path /tmp/nginx 1 2;

                proxy_set_header  X-Real-IP  $remote_addr;
                proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header Host $http_host;
                proxy_set_header X-FORWARDED-PROTO $scheme;
                proxy_redirect off;
                proxy_pass http://localhost:3000;
                break;
                }

        # monit embedded web server
        location /monit/ {
                proxy_set_header Host $host;
                proxy_set_header  X-Real-IP  $remote_addr;
                proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_pass http://localhost:2812;
                proxy_redirect false;
                rewrite ^/monit/(.*) /$1 break;
                proxy_ignore_client_abort on;
        }

        error_page 503 @503;
        # Return a 503 error if the maintenance page exists.
        if (-f /var/www/shk/shared/public/system/maintenance.html) {
          return 503;
        }

        location @503 {
          # Serve static assets if found.
          if (-f $request_filename) {
            break;
          }

          # Set root to the shared directory.
          root /var/www/shk/shared/public;
          rewrite ^(.*)$ /system/maintenance.html break;
        }

    }




